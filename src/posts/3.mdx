---
title: Web Streams APIå…¥é–€
description: ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ã‚’åŠ¹ç‡çš„ã«æ‰±ã†ãŸã‚ã®API
date: 2025-06-05
tags:
  - JavaScript
  - WebAPI
  - Streams
---

## ã¯ã˜ã‚ã«
Web Streams APIã®æ¦‚è¦ã¨ä½¿ã„æ–¹ã«ã¤ã„ã¦å­¦ã‚“ã å†…å®¹ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚
Node.jsã®Streamã¨ã®é•ã„ã‚„å®Ÿéš›ã®ä½¿ç”¨ä¾‹ã«ã¤ã„ã¦ã‚‚è§¦ã‚Œã¦ã„ã¾ã™ã€‚

## ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ã¯
ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›ã‚’**é€æ¬¡çš„ã«åŠ¹ç‡ã‚ˆãæ‰±ã†**ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã™ã€‚
å¤§ããªãƒ‡ãƒ¼ã‚¿ï¼ˆä¾‹ï¼šãƒ•ã‚¡ã‚¤ãƒ«1ã¤ï¼‰ã‚’**å°ã•ãåˆ†å‰²ã•ã‚ŒãŸãƒãƒ£ãƒ³ã‚¯ï¼ˆchunkï¼‰**ã®é€£ç¶šã¨ã—ã¦å‡¦ç†ã§ãã¾ã™ã€‚

```mermaid
flowchart LR
    subgraph A[å¤‰æ›å‡¦ç†A]
        A1[chunk] --> A2[chunk] --> A3[chunk]
    end

    subgraph B[å¤‰æ›å‡¦ç†B]
        B1[chunk] --> B2[chunk] --> B3[chunk]
    end

    subgraph C[å¤‰æ›å‡¦ç†C]
        C1[chunk] --> C2[chunk] --> C3[chunk]
    end

    Start[chunk] --> A1
    A3 --> B1
    B3 --> C1
    C3 --> End[chunk]
```

## ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãƒ¡ãƒªãƒƒãƒˆ

### çœãƒ¡ãƒ¢ãƒª
å°‘ã—ãšã¤ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã‚“ã§å‡¦ç†ã€å‡¦ç†å¾Œã¯é–‹æ”¾ã•ã‚Œã‚‹ãŸã‚ã€å¤§é‡ãƒ‡ãƒ¼ã‚¿ã‚„ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‘ãã§ã™ã€‚

### ä½é…å»¶
æœ€åˆã®ãƒ‡ãƒ¼ã‚¿ã¯æ—©ãå‡¦ç†ã•ã‚Œã‚‹ãŸã‚ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªå‡¦ç†ãŒå¯èƒ½ã§ã™ã€‚

## Streams APIã®æ¦‚è¦
Chunkã®é€£ç¶šã—ãŸæµã‚Œã‚’æ‰±ã†APIã§ã€3ç¨®é¡ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒã‚ã‚Šã¾ã™ã€‚

### ReadableStreamï¼ˆèª­ã¿è¾¼ã¿ï¼‰
ã‚½ãƒ¼ã‚¹ï¼ˆä¾‹ï¼šãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã—ã¦æµã—ã¾ã™ã€‚

```javascript
// ä¾‹ï¼šResponse.body, Blob.stream()
const response = await fetch('/api/data');
const readable = response.body;
```

### TransformStreamï¼ˆå¤‰æ›ï¼‰
ãƒãƒ£ãƒ³ã‚¯ã«å¯¾ã—ã¦å‡¦ç†ã‚’è¡Œã„ã¾ã™ï¼ˆä¾‹ï¼šæ–‡å­—ã‚³ãƒ¼ãƒ‰å¤‰æ›ã€åœ§ç¸®ï¼‰ã€‚

```javascript
const transformStream = new TransformStream({
  transform(chunk, controller) {
    // chunkã‚’å¤‰æ›ã™ã‚‹å‡¦ç†
    controller.enqueue(transformedChunk);
  }
});
```

### WritableStreamï¼ˆæ›¸ãè¾¼ã¿ï¼‰
ãƒ•ã‚¡ã‚¤ãƒ«ã‚„DBãªã©ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚

```javascript
const writableStream = new WritableStream({
  write(chunk) {
    // chunkã‚’æ›¸ãè¾¼ã‚€å‡¦ç†
    console.log(chunk);
  }
});
```

## ãƒ‘ã‚¤ãƒ—å‡¦ç†
ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ã¤ãªã’ã¦å‡¦ç†ãƒã‚§ãƒ¼ãƒ³ã‚’ä½œã‚Œã¾ã™ã€‚

```javascript
readable
  .pipeThrough(transformStream) // æ¬¡ã®å‡¦ç†ã«æµã™
  .pipeTo(writableStream);      // æœ€çµ‚çš„ãªå‡ºåŠ›å…ˆã«é€ã‚‹
```

## ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®åˆ†é…
1ã¤ã® `ReadableStream` ã‚’è¤‡æ•°ã«åˆ†é…ã§ãã¾ã™ã€‚

```mermaid
flowchart LR
    A[Readable Stream<br/>ï¼ˆåŒä¸€ãƒ‡ãƒ¼ã‚¿ï¼‰] -->|ã‚³ãƒ”ãƒ¼â‘ | B1[Transform Stream<br/>ç”¨é€”1: è¡¨ç¤ºç”¨]
    A -->|ã‚³ãƒ”ãƒ¼â‘¡| B2[Transform Stream<br/>ç”¨é€”2: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç”¨]
    B1 --> C1[Writable Stream<br/>ç”»é¢è¡¨ç¤º]
    B2 --> C2[Writable Stream<br/>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜]
```

```javascript
const [stream1, stream2] = readable.tee();
// stream1ã¯è¡¨ç¤ºç”¨ã€stream2ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç”¨ã¨ã—ã¦ä½¿ç”¨
```

## ä¸»ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

### å¤§é‡ãƒ¬ã‚³ãƒ¼ãƒ‰ã®DBã‚¤ãƒ³ãƒãƒ¼ãƒˆ
å°‘ã—ãšã¤å‡¦ç†ã—ã¦ãƒ¡ãƒ¢ãƒªæ¶ˆè²»ã‚’æŠ‘ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### AIãƒãƒ£ãƒƒãƒˆ
ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ã™ãã«è¡¨ç¤ºã§ãã‚‹ãŸã‚ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ„Ÿã®ã‚ã‚‹UIãŒå®Ÿç¾ã§ãã¾ã™ã€‚

## Node.jsã¨ã®é•ã„
Node.jsã«ã¯çµ„ã¿è¾¼ã¿ `Stream` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚Šã€Web Streams APIã‚ˆã‚Šå…ˆã«å­˜åœ¨ã—ã¦ã„ã¾ã—ãŸã€‚

### Node.js Stream
- `Readable`
- `Writable`
- `Duplex`ï¼ˆèª­ã¿æ›¸ãä¸¡æ–¹ï¼‰
- `Transform`
- `PassThrough`ï¼ˆä½•ã‚‚ã—ãªã„ï¼‰

### äº’æ›æ€§
Node.js v21ã§Web Streams APIæœ¬ä½“ãŒStableã«ãªã‚Šã€ç›¸äº’å¤‰æ›ãŒå¯èƒ½ã§ã™ã€‚

```javascript
import { Readable } from "node:stream";

// Web Streams API â†’ Node Stream ã«å¤‰æ›
const nodeStream = Readable.fromWeb(new ReadableStream());

// Node Stream â†’ Web Streams API ã«å¤‰æ›
const webStream = Readable.toWeb(nodeStream);
```

## Web Streams APIã®æ”¹å–„ç‚¹

### æ¨™æº–åŒ–ã•ã‚Œã¦ã„ã¦ä½¿ã„ã‚„ã™ã„
ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œã§ã€ä»–ã®APIï¼ˆFetchãªã©ï¼‰ã¨ã‚‚è¦ªå’Œæ€§ãŒé«˜ã„ã§ã™ã€‚

### ãƒ¢ãƒ€ãƒ³ãªæ›¸ãæ–¹ã«å¯¾å¿œ
`EventEmitter` / `callback` ã§ã¯ãªãã€`Promise` / `async/await` ãƒ™ãƒ¼ã‚¹ã§æ›¸ã‘ã¾ã™ã€‚

### å‹æƒ…å ±ï¼ˆTypeScriptå¯¾å¿œï¼‰
```typescript
// Nodeï¼šchunkã®å‹ãŒany
// Web Streamsï¼šGenericsã§æ˜ç¤ºã§ãã‚‹
const readable = new ReadableStream<string>({
  start(controller) {
    controller.enqueue("Hello");
  }
});
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒãƒ©ã‚¯
Node.jsã§ã¯æ˜ç¤ºçš„ã«`.on("error")`ã¨`.destroy()`ãŒå¿…è¦ã§ã—ãŸãŒã€Web Streamsã¯è‡ªå‹•ã§é–‰ã˜ã¦ãã‚Œã¾ã™ã€‚

## ã¾ã¨ã‚
Web Streams APIã¯ä»¥ä¸‹ã®æ§‹æˆè¦ç´ ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š
- `ReadableStream`ï¼ˆèª­ã¿è¾¼ã¿ï¼‰
- `TransformStream`ï¼ˆå¤‰æ›ï¼‰
- `WritableStream`ï¼ˆæ›¸ãè¾¼ã¿ï¼‰

`pipeThrough()` / `pipeTo()` ã§æ®µéšçš„ã«å‡¦ç†ã§ãã€Node.jsã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ç›¸äº’å¤‰æ›ã‚‚å¯èƒ½ã§ã™ã€‚
`async/await` ã¨ã‚‚çµ„ã¿åˆã‚ã›ã‚„ã™ãã€ç›´æ„Ÿçš„ã§å®‰å…¨ãªã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸğŸ™‹â€â™‚ï¸
